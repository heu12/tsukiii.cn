import{o as $,a as b,i as W}from"./lifecycle.5Ap2lG4L.js";import{c as x,f as I,a as k,p as R,b as j,s as n,m as a,d as s,g as e}from"./template.u9TWndYC.js";import{i as q}from"./if.DvYlwJjJ.js";import"./functions.WhpeioxD.js";import"./config.Bz3CRDzB.js";import"./zh_TW.12WzXWON.js";function O(w,A){j(A,!1);let o=a(!1),c=a(0),d=a(0),D=a(.7),l=a(!1),m=a(!1),v=a(0),M=a(""),p=a(!1),f=a({title:"Sample Song",artist:"Sample Artist",cover:"/favicon/favicon.ico",url:"",duration:0}),i=a([]),u=a(0),t=a();function E(){if(e(i).length<=1)return;let r;if(e(m))do r=Math.floor(Math.random()*e(i).length);while(r===e(u)&&e(i).length>1);else r=e(u)<e(i).length-1?e(u)+1:0;T(r)}function T(r){if(r<0||r>=e(i).length)return;const P=e(o);n(u,r),e(t)&&e(t).pause(),_(e(i)[e(u)]),(P||!e(o))&&setTimeout(()=>{e(t)&&(e(t).readyState>=2?e(t).play().catch(()=>{}):e(t).addEventListener("canplay",()=>{e(t).play().catch(()=>{})},{once:!0}))},100)}function C(r){return r.startsWith("http://")||r.startsWith("https://")||r.startsWith("/")?r:`/${r}`}function _(r){!r||!e(t)||(n(f,{...r}),r.url?(n(l,!0),e(t).pause(),s(t,e(t).currentTime=0),n(c,0),n(d,r.duration??0),e(t).removeEventListener("loadeddata",h),e(t).removeEventListener("error",g),e(t).removeEventListener("loadstart",L),e(t).addEventListener("loadeddata",h,{once:!0}),e(t).addEventListener("error",g,{once:!0}),e(t).addEventListener("loadstart",L,{once:!0}),s(t,e(t).src=C(r.url)),e(t).load()):n(l,!1))}function h(){n(l,!1),e(t)?.duration&&e(t).duration>1&&(n(d,Math.floor(e(t).duration)),e(i)[e(u)]&&s(i,e(i)[e(u)].duration=e(d)),s(f,e(f).duration=e(d)))}function g(r){n(l,!1),y(`无法播放 "${e(f).title}"，正在尝试下一首...`),e(i).length>1?setTimeout(()=>E(),1e3):y("播放列表中没有可用的歌曲")}function L(){}function y(r){n(M,r),n(p,!0),setTimeout(()=>{n(p,!1)},3e3)}function B(){e(t)&&(e(t).addEventListener("play",()=>{n(o,!0)}),e(t).addEventListener("pause",()=>{n(o,!1)}),e(t).addEventListener("timeupdate",()=>{n(c,e(t).currentTime)}),e(t).addEventListener("ended",()=>{e(v)===1?(s(t,e(t).currentTime=0),e(t).play().catch(()=>{})):e(v)===2||e(u)<e(i).length-1||e(m)?E():n(o,!1)}),e(t).addEventListener("error",r=>{n(l,!1)}),e(t).addEventListener("stalled",()=>{}),e(t).addEventListener("waiting",()=>{}))}$(()=>{n(t,new Audio),s(t,e(t).volume=e(D)),B()}),b(()=>{e(t)&&(e(t).pause(),s(t,e(t).src=""))}),W();var S=x(),F=I(S);q(F,r=>{}),k(w,S),R()}export{O as default};
